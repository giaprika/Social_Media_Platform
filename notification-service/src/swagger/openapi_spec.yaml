openapi: 3.0.3
info:
  title: Notification Service API
  version: 1.0.0
  description: API for managing notifications in the Notification Service.

servers:
  - url: http://localhost:8002
    description: Local development server

paths:
  /notifications:
    get:
      summary: Get user's notifications
      tags:
        - Notifications
      parameters:
        - $ref: '#/components/parameters/x-user-id'
      responses:
        '200':
          description: A list of notifications for the user.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Notification'
              example:
                   - id: "5498bb95-8821-4677-ae41-e96d9dc06b49"
                     user_id: "3ab3e505-82f0-4a6b-8a5b-187aef806a5a"
                     title_template: "Bạn có bài mới"
                     body_template: "User Test vừa đăng bài mới"
                     is_readed: false
                     created_at: "2025-11-15T09:23:12.113Z"

        '400':
          description: Bad Request - Invalid user ID.
        '500':
          description: Internal Server Error.

    post:
      summary: Create notifications for multiple users
      tags:
        - Notifications
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              $ref: '#/components/schemas/CreateNotificationRequest'
      responses:
        '201':
          description: Notifications created successfully.
        '400':
          description: Bad Request - Invalid input data.
        '500':
          description: Internal Server Error.
          
  /notifications/{notification_id}:
    delete:
      summary: Delete a notification
      tags:
        - Notifications
      parameters:
        - in: path
          name: notification_id
          required: true
          schema:
            type: string
            format: uuid
          description: ID of the notification to be deleted.
      responses:
        '200':
          description: Notification deleted successfully.
        '400':
          description: Bad Request - Invalid notification ID.
        '404':
          description: Not Found - Notification does not exist.
        '500':
          description: Internal Server Error.

  /notifications/{notification_id}/read:
    patch:
      summary: Mark a notification as read
      tags:
        - Notifications
      parameters:
        - in: path
          name: notification_id
          required: true
          schema:
            type: string
            format: uuid
          description: ID of the notification to be marked as read.
      responses:
        '200':
          description: Notification marked as read successfully.
        '400':
          description: Bad Request - Invalid notification ID.
        '404':
          description: Not Found - Notification does not exist.
        '500':
          description: Internal Server Error.

components:
  parameters:
    x-user-id:
      name: x-user-id
      in: header
      description: >-
        User ID injected by backend-gateway after JWT authentication.
        This header is NOT for public clients. For testing in Swagger UI,
        you can manually set this header to simulate gateway behavior.
      required: true
      schema:
        type: string
        format: uuid
      example: "3ab3e505-82f0-4a6b-8a5b-187aef806a5a"
  schemas:
    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the notification.
        user_id:
          type: string
          format: uuid
          description: ID of the user to whom the notification belongs.
        title_template:
          type: string
          description: Title template of the notification.
        body_template:
          type: string
          description: Body template of the notification.
        is_readed:
          type: boolean
          description: Indicates whether the notification has been read.
        created_at:
          type: string
          format: date-time
          description: Timestamp when the notification was created.
      required:
        - id
        - user_id
        - title_template
        - body_template
        - is_readed
        - created_at
    
    CreateNotificationRequest:
      type: object
      properties:
        user_ids:
          type: array
          items:
            type: string
            format: uuid
          description: List of user IDs to receive the notification.
        title_template:
          type: string
          description: Title template of the notification.
        body_template:
          type: string
          description: Body template of the notification.
      required:
        - user_ids
        - title_template
        - body_template